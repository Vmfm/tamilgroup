<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tamil Dating / Chat App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<style>
body{font-family:Arial;background:#f2f2f2;margin:0}
header{background:#ff2e63;color:#fff;padding:12px;text-align:center;font-size:20px}
#login,#users,#chat{padding:15px}
input,select,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
button{background:#ff2e63;color:#fff;border:none;font-size:16px}
.card{background:#fff;border-radius:12px;margin:10px 0;padding:10px;display:flex;align-items:center;cursor:pointer}
.card img{width:60px;height:60px;border-radius:50%;object-fit:cover;margin-right:10px}
.online{width:10px;height:10px;background:#2ecc71;border-radius:50%;margin-left:auto}
#chat{display:none}
#messages{height:300px;overflow-y:auto;background:#fff;padding:10px;border-radius:10px}
.msg{margin:6px 0}
.me{color:#ff2e63;font-weight:bold}
</style>
</head>
<body>
<header>❤️ Tamil Dating Chat</header>

<div id="login">
<h3>Create Profile</h3>
<input id="name" placeholder="Name">
<input id="age" type="number" placeholder="Age">
<select id="gender"><option>Male</option><option>Female</option></select>
<input id="photoFile" type="file">
<button onclick="login()">Enter</button>
</div>

<div id="users" style="display:none"></div>

<div id="chat">
<h3 id="chatName"></h3>
<div id="messages"></div>
<input id="msgInput" placeholder="Type message">
<button onclick="sendMsg()">Send</button>
<button onclick="endChat()">Back</button>
</div>

<script>
// Firebase Config
const firebaseConfig = {
apiKey: "AIzaSyB1VbLbqBxCiG_bfGoQgQyapXwHUQ-Q7BU",
authDomain: "tamil-chat-2d54e.firebaseapp.com",
databaseURL: "https://tamil-chat-2d54e-default-rtdb.firebaseio.com",
projectId: "tamil-chat-2d54e",
storageBucket: "tamil-chat-2d54e.appspot.com",
messagingSenderId: "804705969240",
appId: "1:804705969240:web:658df281dd8360843"
};
firebase.initializeApp(firebaseConfig);
const auth=firebase.auth();
const db=firebase.database();
const storage=firebase.storage();
let myId=null,chatWith=null;

// Anonymous login
auth.signInAnonymously();
auth.onAuthStateChanged(u=>{if(u){myId=u.uid}});

function login(){
const file=document.getElementById('photoFile').files[0];
if(!file){alert('Select a profile image');return;}
const storageRef=storage.ref('profiles/'+myId);
storageRef.put(file).then(snap=>snap.ref.getDownloadURL()).then(url=>{
const data={name:name.value,age:age.value,gender:gender.value,photo:url,online:true};
db.ref('users/'+myId).set(data);
document.getElementById('login').style.display='none';
document.getElementById('users').style.display='block';
loadUsers();
});
}

window.onbeforeunload=()=>db.ref('users/'+myId+'/online').set(false);

function loadUsers(){
db.ref('users').on('value',s=>{
users.innerHTML='';
s.forEach(u=>{
if(u.key!==myId){
let d=u.val();
users.innerHTML+=`<div class='card' onclick="openChat('${u.key}','${d.name}')"><img src='${d.photo}'><div>${d.name}, ${d.age}<br>${d.gender}</div>${d.online?'<span class=online></span>':''}</div>`;
}}
)});
}

function openChat(uid,name){
chatWith=uid;
users.style.display='none';
chat.style.display='block';
chatName.innerText='Chat with '+name;
loadMsgs();
}

function loadMsgs(){
const room=myId<chatWith?myId+chatWith:chatWith+myId;
db.ref('chats/'+room).on('value',s=>{
messages.innerHTML='';
s.forEach(m=>{
let v=m.val();
messages.innerHTML+=`<div class='msg'><span class='${v.from==myId?'me':''}'>${v.text}</span></div>`;
});
messages.scrollTop=messages.scrollHeight;
});
}

function sendMsg(){
const room=myId<chatWith?myId+chatWith:chatWith+myId;
db.ref('chats/'+room).push({from:myId,text:msgInput.value});
msgInput.value='';
}

function endChat(){chat.style.display='none';users.style.display='block'}
</script>
</body>
</html>
