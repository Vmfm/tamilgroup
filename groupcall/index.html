<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Firebase Dating App Demo</title>
<style>
body{margin:0;font-family:Arial;background:#0f172a;color:#fff}
.hidden{display:none}
input,select,button{padding:10px;margin:5px 0;width:100%;border-radius:6px;border:none}
button{background:#22c55e;color:#000;font-weight:bold;cursor:pointer}
.container{max-width:420px;margin:auto;padding:15px}
.card{background:#020617;border-radius:12px;padding:12px;margin:10px 0;position:relative}
.avatar{width:100%;border-radius:10px}
.online{position:absolute;top:10px;right:10px;width:12px;height:12px;border-radius:50%}
.online.on{background:#22c55e}
.online.off{background:#64748b}
.topbar{display:flex;justify-content:space-between;align-items:center}
.profileRow{display:flex;gap:10px;align-items:center}
.profileRow img{width:45px;height:45px;border-radius:50%}
.chatBox{height:260px;overflow:auto;background:#020617;padding:10px;border-radius:10px}
.msg{margin:6px 0}
.msg.me{text-align:right;color:#22c55e}
.notification{position:fixed;top:10px;right:10px;background:#020617;padding:10px;border-radius:10px;display:flex;gap:10px;align-items:center}
.notification img{width:40px;height:40px;border-radius:50%}
</style>
</head>
<body>

<div class="container" id="login">
  <h2>Login / Register</h2>
  <input id="name" placeholder="Name" />
  <input id="age" type="number" placeholder="Age" />
  <select id="gender"><option>Male</option><option>Female</option></select>
  <input id="photo" type="file" />
  <button onclick="register()">Continue</button>
</div>

<div class="container hidden" id="profiles">
  <div class="topbar">
    <h3>Profiles</h3>
    <button onclick="openSettings()">⚙️</button>
  </div>
  <div id="profileList"></div>
</div>

<div class="container hidden" id="chat">
  <div class="topbar">
    <button onclick="backProfiles()">⬅</button>
    <h3 id="chatName"></h3>
    <button onclick="blockUser()">Block</button>
  </div>
  <div class="chatBox" id="messages"></div>
  <input id="msgInput" placeholder="Message" />
  <button onclick="sendMsg()">Send</button>
</div>

<div class="container hidden" id="settings">
  <h3>Settings</h3>
  <input type="file" id="newPhoto" />
  <button onclick="updatePhoto()">Change Profile Image</button>
  <button onclick="closeSettings()">Close</button>
</div>

<div id="notify" class="notification hidden"></div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
 apiKey: "AIzaSyB1VbLbqBxCiG_bfGoQgQyapXwHUQ-Q7BU",
 authDomain: "tamil-chat-2d54e.firebaseapp.com",
 databaseURL: "https://tamil-chat-2d54e-default-rtdb.firebaseio.com",
 projectId: "tamil-chat-2d54e",
 storageBucket: "tamil-chat-2d54e.appspot.com",
 messagingSenderId: "804705969240",
 appId: "1:804705969240:web:658df281dd8360843"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

let myId = localStorage.getItem('uid');
let chatWith = null;

function register(){
 const uid = Date.now().toString();
 const file = photo.files[0];
 storage.ref('profiles/'+uid).put(file).then(s=>s.ref.getDownloadURL()).then(url=>{
  db.ref('users/'+uid).set({name:name.value,age:age.value,gender:gender.value,photo:url,online:true,blocked:{}});
  localStorage.setItem('uid',uid);
  myId=uid; showProfiles();
 });
}

function showProfiles(){
 login.classList.add('hidden'); profiles.classList.remove('hidden');
 db.ref('users').on('value',snap=>{
  profileList.innerHTML='';
  snap.forEach(u=>{
   if(u.key===myId) return;
   const d=u.val();
   profileList.innerHTML+=`<div class='card' onclick="openChat('${u.key}','${d.name}')">
    <img src='${d.photo}' class='avatar'>
    <div class='online ${d.online?'on':'off'}'></div>
    <p>${d.name}, ${d.age} (${d.gender})</p>
   </div>`;
  });
 });
 listenNotifications();
}

function openChat(uid,name){chatWith=uid; profiles.classList.add('hidden'); chat.classList.remove('hidden'); chatName.innerText=name; loadMsgs();}
function backProfiles(){chat.classList.add('hidden'); profiles.classList.remove('hidden');}

function sendMsg(){
 const msg={from:myId,text:msgInput.value,time:Date.now()};
 db.ref('chats/'+chatWith+'/'+myId).push(msg);
 msgInput.value='';
}

function loadMsgs(){
 messages.innerHTML='';
 db.ref('chats/'+myId+'/'+chatWith).on('child_added',s=>{
  const m=s.val();
  messages.innerHTML+=`<div class='msg ${m.from===myId?'me':''}'>${m.text}</div>`;
 });
}

function listenNotifications(){
 db.ref('chats/'+myId).on('child_added',snap=>{
  const uid=snap.key;
  db.ref('users/'+uid).once('value',u=>{
   const d=u.val();
   notify.innerHTML=`<img src='${d.photo}'><div>New message from ${d.name}</div>`;
   notify.classList.remove('hidden');
   setTimeout(()=>notify.classList.add('hidden'),3000);
  });
 });
}

function blockUser(){ db.ref('users/'+myId+'/blocked/'+chatWith).set(true); alert('User blocked'); }

function openSettings(){ settings.classList.remove('hidden'); }
function closeSettings(){ settings.classList.add('hidden'); }
function updatePhoto(){
 const file=newPhoto.files[0];
 storage.ref('profiles/'+myId).put(file).then(s=>s.ref.getDownloadURL()).then(url=>db.ref('users/'+myId+'/photo').set(url));
}

if(myId) showProfiles();
</script>
</body>
</html>
