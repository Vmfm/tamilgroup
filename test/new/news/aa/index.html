<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Simple Group + Private Chat</title>

<style>
body{
    margin:0;
    font-family: Arial, sans-serif;
    background:#f2f2f2;
}

#loginScreen, #chatScreen{
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.card{
    background:white;
    padding:20px;
    width:350px;
    border-radius:10px;
    box-shadow:0 0 10px rgba(0,0,0,0.1);
}

input{
    width:100%;
    padding:10px;
    margin:5px 0;
    border:1px solid #ccc;
    border-radius:5px;
}

button{
    padding:10px;
    border:none;
    border-radius:5px;
    background:#4CAF50;
    color:white;
    cursor:pointer;
    margin-top:5px;
}

button:hover{
    background:#45a049;
}

#chatContainer{
    display:flex;
    height:100vh;
}

#users{
    width:30%;
    background:white;
    padding:10px;
    overflow-y:auto;
    border-right:1px solid #ddd;
}

#messages{
    width:70%;
    display:flex;
    flex-direction:column;
}

#chatBox{
    flex:1;
    padding:10px;
    overflow-y:auto;
    background:#fafafa;
}

.message{
    margin-bottom:10px;
}

.me{
    text-align:right;
    color:blue;
}

.privateTitle{
    background:#eee;
    padding:5px;
    font-size:14px;
}

#inputArea{
    display:flex;
    padding:10px;
    background:white;
    border-top:1px solid #ddd;
}

#inputArea input{
    flex:1;
    margin-right:5px;
}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginScreen">
  <div class="card">
    <h2>Enter Your Name</h2>
    <input type="text" id="username" placeholder="Your Name">
    <button onclick="login()">Enter Chat</button>
  </div>
</div>

<!-- CHAT -->
<div id="chatScreen" style="display:none;">
  <div id="chatContainer">

    <div id="users">
      <h3>Users</h3>
      <button onclick="openGroup()">Group Chat</button>
      <div id="userList"></div>
    </div>

    <div id="messages">
      <div class="privateTitle" id="chatTitle">Group Chat</div>
      <div id="chatBox"></div>

      <div id="inputArea">
        <input type="text" id="messageInput" placeholder="Type message...">
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

  </div>
</div>

<script>
let currentUser = localStorage.getItem("myName");
let currentChat = "group";

/* AUTO LOGIN */
if(currentUser){
    showChat();
}

/* LOGIN */
function login(){
    let name = document.getElementById("username").value.trim();
    if(name){
        localStorage.setItem("myName", name);
        currentUser = name;
        showChat();
    }
}

function showChat(){
    document.getElementById("loginScreen").style.display="none";
    document.getElementById("chatScreen").style.display="block";
    loadUsers();
    loadMessages();
}

/* LOAD USERS */
function loadUsers(){
    let group = JSON.parse(localStorage.getItem("groupChat")) || [];
    let users = [...new Set(group.map(m => m.name))];

    let list = document.getElementById("userList");
    list.innerHTML="";
    users.forEach(u=>{
        if(u!==currentUser){
            let btn=document.createElement("button");
            btn.innerText=u;
            btn.onclick=()=>openPrivate(u);
            list.appendChild(btn);
        }
    });
}

/* OPEN GROUP */
function openGroup(){
    currentChat="group";
    document.getElementById("chatTitle").innerText="Group Chat";
    loadMessages();
}

/* OPEN PRIVATE */
function openPrivate(user){
    currentChat=user;
    document.getElementById("chatTitle").innerText="Private Chat with "+user;
    loadMessages();
}

/* LOAD MESSAGES */
function loadMessages(){
    let chatBox=document.getElementById("chatBox");
    chatBox.innerHTML="";

    let messages;

    if(currentChat==="group"){
        messages=JSON.parse(localStorage.getItem("groupChat"))||[];
    }else{
        let key1="private_"+currentUser+"_"+currentChat;
        let key2="private_"+currentChat+"_"+currentUser;
        messages=(JSON.parse(localStorage.getItem(key1))||[])
            .concat(JSON.parse(localStorage.getItem(key2))||[]);
    }

    messages.forEach(m=>{
        let div=document.createElement("div");
        div.className="message";
        if(m.name===currentUser){
            div.classList.add("me");
        }
        div.innerHTML="<b>"+m.name+":</b> "+m.text;
        chatBox.appendChild(div);
    });

    chatBox.scrollTop=chatBox.scrollHeight;
}

/* SEND MESSAGE */
function sendMessage(){
    let input=document.getElementById("messageInput");
    let text=input.value.trim();
    if(!text) return;

    let message={name:currentUser,text:text};

    if(currentChat==="group"){
        let group=JSON.parse(localStorage.getItem("groupChat"))||[];
        group.push(message);
        localStorage.setItem("groupChat",JSON.stringify(group));
    }else{
        let key="private_"+currentUser+"_"+currentChat;
        let chat=JSON.parse(localStorage.getItem(key))||[];
        chat.push(message);
        localStorage.setItem(key,JSON.stringify(chat));
    }

    input.value="";
    loadUsers();
    loadMessages();
}

/* ENTER KEY SEND */
document.getElementById("messageInput").addEventListener("keypress",function(e){
    if(e.key==="Enter"){
        sendMessage();
    }
});
</script>

</body>
</html>
