<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Group Chat</title>

<style>
/* ---------- COLORS ---------- */
:root{
  --bg:#111b21;
  --panel:#202c33;
  --accent:#25d366;
  --muted:#97a4ab;
}

/* ---------- BASE ---------- */
body{
  margin:0;
  background:var(--bg);
  color:#e9edef;
  font-family:Arial,system-ui;
  height:100vh;
  overflow:hidden;
}

#app{
  height:100vh;
  display:flex;
  flex-direction:column;
  max-width:900px;
  margin:0 auto;
}

/* ---------- TOP BAR ---------- */
#topBar{
  padding:10px;
  background:#0b141a;
  display:flex;
  align-items:center;
  gap:10px;
}

#title{
  font-size:18px;
  font-weight:700;
}

#unreadTotal{
  margin-left:8px;
  font-size:14px;
  color:#ff5555;
}

/* ---------- MESSAGES ---------- */
#messages{
  flex:1;
  overflow-y:auto;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
  background:#071215;
}

.msg-row{
  display:flex;
  align-items:flex-end;
  max-width:80%;
}

.msg-row.self{
  align-self:flex-end;
  flex-direction:row-reverse;
}

.avatar{
  width:35px;
  height:35px;
  background:#000;
  color:#fff;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  margin:0 8px;
  cursor:pointer;
  position:relative;
  border:2px solid transparent;
}

/* ---------- AVATAR POPUP ---------- */
.popup-menu{
  display:none;
  position:absolute;
  top:-80px;
  left:0;
  background:var(--panel);
  border-radius:8px;
  padding:6px;
  flex-direction:column;
  min-width:120px;
  z-index:999;
}

.avatar:active .popup-menu,
.avatar:hover .popup-menu{
  display:flex;
}

.popup-menu button{
  background:none;
  color:#fff;
  border:0;
  padding:6px;
  text-align:left;
  cursor:pointer;
  border-radius:6px;
}

/* ---------- CHAT BUBBLES ---------- */
.bubble{
  background:var(--panel);
  padding:8px 12px;
  border-radius:10px;
  font-size:14px;
}

.msg-row.self .bubble{
  background:#005c4b;
}

.time{
  font-size:11px;
  color:var(--muted);
  margin-top:6px;
  text-align:right;
}

.meta{
  font-size:12px;
  color:#53bdeb;
  margin-bottom:4px;
}

/* ---------- INPUT BAR ---------- */
#inputBar{
  display:flex;
  padding:10px;
  background:var(--panel);
  gap:8px;
}

#messageInput{
  flex:1;
  padding:10px;
  background:#2a3942;
  border:0;
  border-radius:20px;
  color:#fff;
  font-size:14px;
}

#sendBtn{
  width:45px;
  height:45px;
  border-radius:50%;
  border:0;
  background:var(--accent);
  color:#fff;
  font-size:18px;
}

/* ---------- STATUS ---------- */
#statusLine{
  font-size:13px;
  color:var(--muted);
  padding:4px 12px;
}

/* ---------- TOAST ---------- */
#toast{
  position:fixed;
  bottom:24px;
  left:50%;
  transform:translateX(-50%);
  background:#2a3942;
  color:#fff;
  padding:10px 16px;
  border-radius:10px;
  opacity:0;
  transition:.25s;
  z-index:9999;
}

#toast.show{
  opacity:1;
  bottom:40px;
}

/* ---------- PRIVATE CHAT PANEL ---------- */
#privatePanel{
  position:fixed;
  top:0;
  right:-100%;
  width:80%;
  max-width:420px;
  height:100%;
  background:#000;
  display:flex;
  flex-direction:column;
  transition:right .35s ease;
  z-index:9000;
}

#privateHeader{
  padding:12px;
  background:#111;
  display:flex;
  align-items:center;
  justify-content:space-between;
}

#privateTitle{
  font-size:17px;
  font-weight:700;
}

#unblockBtn{
  background:#ff4444;
  color:#fff;
  border:0;
  padding:6px 10px;
  border-radius:6px;
  font-size:13px;
}

/* ---------- PRIVATE MESSAGES ---------- */
#privateMessages{
  flex:1;
  overflow-y:auto;
  padding:12px;
  display:flex;
  flex-direction:column;
  gap:8px;
}

#privateInputBar{
  display:flex;
  padding:10px;
  background:#111;
  gap:6px;
}

#privateInput{
  flex:1;
  padding:8px;
  border:0;
  border-radius:10px;
  background:#222;
  color:#fff;
}

#privateSendBtn{
  width:40px;
  height:40px;
  border-radius:50%;
  background:var(--accent);
  border:0;
  color:#fff;
}

#privateTyping{
  color:#aaa;
  font-size:13px;
  padding-left:10px;
}

/* ---------- SETTINGS PANEL ---------- */
#settingsPanel{
  position:fixed;
  left:-70%;
  top:0;
  width:70%;
  max-width:320px;
  height:100%;
  background:#111;
  padding:20px;
  transition:left .35s ease;
  z-index:9500;
}

.settingRow{
  background:#222;
  padding:12px;
  margin-bottom:10px;
  border-radius:10px;
}
</style>
</head>
<body>

<div id="app">

  <!-- TOP BAR -->
  <div id="topBar">
    <button id="settingsBtn" style="background:none;border:0;color:#fff;font-size:20px;">‚öôÔ∏è</button>

    <div id="title">Group Chat</div>
    <div id="unreadTotal"></div>

    <button id="privateToggle" style="margin-left:auto;background:none;border:0;color:#fff;font-size:20px;">üí¨</button>
  </div>

  <div id="statusLine"></div>

  <div id="messages"></div>

  <!-- INPUT BAR -->
  <div id="inputBar">
    <input id="messageInput" placeholder="Type a message‚Ä¶" />
    <button id="sendBtn">‚úàÔ∏è</button>
  </div>
</div>

<!-- PRIVATE CHAT PANEL -->
<div id="privatePanel">
  <div id="privateHeader">
    <div id="privateTitle">Private Chat</div>
    <button id="unblockBtn" style="display:none">Unblock</button>
  </div>

  <div id="privateTyping"></div>

  <div id="privateMessages"></div>

  <div id="privateInputBar">
    <input id="privateInput" placeholder="Type privately‚Ä¶" />
    <button id="privateSendBtn">‚úàÔ∏è</button>
  </div>
</div>

<!-- SETTINGS PANEL -->
<div id="settingsPanel">
  <div class="settingRow">
    <label>
      <input type="checkbox" id="togglePrivate" checked/>
      Enable Private Chat
    </label>
  </div>
</div>

<div id="toast"></div>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>

// ----------------------------------------------------
// FIREBASE CONFIG (YOUR DETAILS)
// ----------------------------------------------------
const firebaseConfig = {
  apiKey: "AIzaSyB1VbLbqBxCiG_bfGoQgQyapXwHUQ-Q7BU",
  authDomain: "tamil-chat-2d54e.firebaseapp.com",
  databaseURL: "https://tamil-chat-2d54e-default-rtdb.firebaseio.com",
  projectId: "tamil-chat-2d54e",
  storageBucket: "tamil-chat-2d54e.appspot.com",
  messagingSenderId: "804705969240",
  appId: "1:804705969240:web:658df281dd8360843c162d"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// ----------------------------------------------------
// VARIABLES
// ----------------------------------------------------
const messagesDiv = document.getElementById("messages");
const messageInput = document.getElementById("messageInput");
const sendBtn = document.getElementById("sendBtn");
const toast = document.getElementById("toast");
const privatePanel = document.getElementById("privatePanel");
const privateMessages = document.getElementById("privateMessages");
const privateSendBtn = document.getElementById("privateSendBtn");
const privateInput = document.getElementById("privateInput");
const privateTyping = document.getElementById("privateTyping");
const privateTitle = document.getElementById("privateTitle");

let myName = "User" + Math.floor(Math.random()*9999);
let currentPrivateUser = null;

// ----------------------------------------------------
// TOAST
// ----------------------------------------------------
function showToast(msg){
  toast.innerText = msg;
  toast.classList.add("show");
  setTimeout(()=>toast.classList.remove("show"),1500);
}

// ----------------------------------------------------
// GROUP MESSAGE LISTENER
// ----------------------------------------------------
db.ref("group").on("child_added", snap=>{
  addGroupMsg(snap.val());
});

function addGroupMsg(msg){
  const row = document.createElement("div");
  row.className = "msg-row" + (msg.name===myName ? " self":"");

  const avatar = document.createElement("div");
  avatar.className="avatar";
  avatar.innerText = msg.name[0];
  avatar.onclick = ()=>openPrivate(msg.name);

  const bubble = document.createElement("div");
  bubble.className="bubble";
  bubble.innerHTML = `<div class='meta'>${msg.name}</div>${msg.text}`;

  row.appendChild(avatar);
  row.appendChild(bubble);

  messagesDiv.appendChild(row);
  messagesDiv.scrollTop = messagesDiv.scrollHeight;
}

// ----------------------------------------------------
// SEND GROUP MESSAGE
// ----------------------------------------------------
sendBtn.onclick = ()=>{
  if(!messageInput.value.trim()) return;
  db.ref("group").push({
    name: myName,
    text: messageInput.value,
    time: Date.now()
  });
  messageInput.value="";
};

// ----------------------------------------------------
// OPEN PRIVATE CHAT
// ----------------------------------------------------
function openPrivate(user){
  if(!document.getElementById("togglePrivate").checked){
    showToast("Private chat disabled");
    return;
  }
  if(user === myName) return;

  currentPrivateUser = user;
  privateTitle.innerText = user;
  privateMessages.innerHTML="";
  privatePanel.style.right="0";

  loadPrivateMsgs(user);
}

// ----------------------------------------------------
// LOAD PRIVATE CHAT
// ----------------------------------------------------
function loadPrivateMsgs(user){
  privateMessages.innerHTML="";

  const myRef = db.ref("private/"+myName+"/"+user);
  const theirRef = db.ref("private/"+user+"/"+myName);

  myRef.on("child_added", s=>addPrivateBubble(s.val(), true));
  theirRef.on("child_added", s=>addPrivateBubble(s.val(), false));
}

function addPrivateBubble(msg, isMine){
  const row = document.createElement("div");
  row.className="msg-row" + (isMine ? " self":"");

  const bubble = document.createElement("div");
  bubble.className="bubble";
  bubble.innerText = msg.text;

  row.appendChild(bubble);
  privateMessages.appendChild(row);

  privateMessages.scrollTop = privateMessages.scrollHeight;
}

// ----------------------------------------------------
// SEND PRIVATE MESSAGE
// ----------------------------------------------------
privateSendBtn.onclick = ()=>{
  if(!privateInput.value.trim()) return;
  if(!currentPrivateUser) return;

  db.ref("private/"+myName+"/"+currentPrivateUser).push({
    text: privateInput.value,
    time: Date.now()
  });

  privateInput.value="";
};

// ----------------------------------------------------
// CLOSE PRIVATE PANEL
// ----------------------------------------------------
document.getElementById("privateToggle").onclick = ()=>{
  privatePanel.style.right="-100%";
};

// ----------------------------------------------------
// PRIVATE TYPING
// ----------------------------------------------------
privateInput.oninput = ()=>{
  if(!currentPrivateUser) return;

  db.ref("typing/"+myName+"/"+currentPrivateUser).set(true);
  setTimeout(()=>{
    db.ref("typing/"+myName+"/"+currentPrivateUser).set(false);
  }, 800);
};

db.ref("typing").on("value", snap=>{
  if(!currentPrivateUser) return;
  const val = snap.val()?.[currentPrivateUser]?.[myName];
  privateTyping.innerText = val ? "typing‚Ä¶" : "";
});

// ----------------------------------------------------
// SETTINGS PANEL
// ----------------------------------------------------
document.getElementById("settingsBtn").onclick=()=>{
  document.getElementById("settingsPanel").style.left="0";
};

document.body.onclick = (e)=>{
  if(e.target.id==="settingsBtn" || 
     e.target.closest("#settingsPanel")) return;

  document.getElementById("settingsPanel").style.left="-70%";
};

</script>
</body>
</html>
